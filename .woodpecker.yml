pipeline:
  test-web:
    group: test
    image: python:3.10-alpine
    commands:
      - pip3 install Flask==2.1.0 gunicorn==20.1.0 pytest==7.1.1
      - python3 -m pytest
    when:
      path:
        - "vapronvapw/**"
        - "**/*.html"
  build-image:
    image: woodpeckerci/plugin-docker-buildx
    settings:
      platforms: linux/arm/v7,linux/arm64/v8,linux/amd64,darwin/amd64,darwin/arm64
      dockerfile: ./Dockerfile
    when:
      event: [push]
      path:
        - "vapronvapw/**"
        - "**/*.html"
    depends_on:
      - test-web
